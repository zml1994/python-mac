import requests
import json
import time
import sqlite3
from sqlite封装 import get_db_conn, close_db_conn
import sqlite3
from sqlite封装 import get_db_conn, close_db_conn
# from 项目报备 import main1
db_file = 'test.db'

list4 = ["33010620210125012002","33013920210125012001","33011120210125012001","33011020210125012003","33011020210125012002","33010820210125012001","33011120210125012002","33010320210125012002","33010420210125022001","33010420210125012001","33010420210125012002","33010620210125012003","33010620210125012004","33010120210125012002","33010920210125012005","33010620210125012005","33011020210125012004","33011220210125012002","33010120210125012003","33010620210125012006","33010120210125022003","33010120210125992001","33010820210125012002","33010620210125012007","33012720210125012001","33010120210125022004","33018220210125012001","33011020210125022001","33010620210125012008","33010120210125012004","33010120210125022006","33010120210125022005","33013920210125012002","33013920210125012003","33013920210125022001","33010120210125022007","33010420210125022002","33010420210125012003","33010920210125012006","33010920210125012007","33010920210125012008","33010120210125022009","33010120210125022008","33010820210125012003","33010520210125012001","33011120210125012003","33010820210125012004","33010920210125012009","33010620210125012009","33010420210125022003","33010120210125022010","33011020210125012005","33010420210125012004","33010620210125012010","33010920210125012010","33010920210125012013","33010920210125012011","33010920210125012012","33010920210125012014","33010920210125012015","33010920210125012016","33011020210125012006","33010920210125012017","33010920210125012018","33011020210125012007","33010920210125012019","33010120210125022011","33011020210125012008","33010120210125022012","33011120210125012004","33010620210125012011","33011220210125012003","33010320210125012003","33010520210125012002","33010920210125022001","33011220210125012004","33010620210125012012","33010920210125012020"]
list3 = ["33010920210125012003","33010120210125022002","33010620210125012001","33010920210125012004","33010320210125012001"]

def select_score_all(appid):
    sql = '''select name from ls1 where appid = ?
    '''
    appid1 = (appid,)
    conn = sqlite3.connect(db_file)  # 打开或创建数据库文件
    cur = conn.cursor()  # 创建游标
    cur.execute(sql, appid1)  # 执行sql语句
    print(cur.fetchall())  # 打印所有结果
    cur.close()  # 关闭游标
    conn.close()  # 关闭数据库

def askUrl(appid):
    url = 'http://jzgr.mohurd.gov.cn/zjhzs/Mgt/Project/QueryProject'
    headers = {
        'Content-Type': 'application/json; charset=utf-8',
        'cookie': 'Hm_lvt_eae7ea7b5967c9be2ddb3158b3cbd890=1611560500; auth.jzgr.mohurd=E8F6B78924847D53F9ABC01AAD0CB10143A50C4AF325EE3ABD3B535C69906CE725015F7A01BCE509BD84CBCFE440D6F1AF48DA9EB7958DA457075582AE7640BFA5B7E706681B412BE55ED68D0F4693CC9C695AC44859BD5DBB453154A19F96DDAA54EF6A1BB0E72CA077125AD37816D051B3780CB533E94DD511377880B72719C6D7109D7D4CBCF25D35A3654DBC5EA26DEB82E369955A973CABACFA3B99B00E0A845ACDEC42CC122EFE1BC38918572A92ED0F11DC7BD0E1DCDDB83A8F6820E6CCA7033BB8D0A32AF48D513D2D07B3C26D39AAC4FB54BDEB626A5B6FA5225724B82CC3FD73C41F597E1E2611C6CF072761B2008402CE74976E81BF1755B285FC8F973D2E21D16519A61A39711F38C06E05AADD4BE54EFEFA2991ED1DB57CFFAD23002EFA4EC5E79A54BBBE26E00308830B1E4CFAF4719A70931A9F5B3F56DD3286E3791BA333160FB93DBCDEBF03824E4B4F2AFDD473F305E219339DE8B45B0C92500991706977F5F6308ED182919F9BB4C9CD3788EBEAFF305A5715D62FFDF791715396247F5ADDE1B8592459999C95A458F9D867053E4779B494A3677769CDFE35059B840C1B368CA918E0B1616B30E57977BC9B6C8A3D1BB2FF94899F3292F3838952E8BFE949777A0D7C961E826F74810C57DB77C0FE3493D332CA50B4B7E8B2B6CE51E665E222861682C61D09D0AAD7D7C8FC441C4B9485BE08FB18A542547FA771EB54D0A05C40DB0D685FFEE517106BD7C22CEE1A463184693D38DCE856E7EDF3D61DF2325A3FC85497C5; verifycode.jzgr.mohurd=22A0601DC39C1F8E301BAF995A9D0D3DF53E144E2C5C15B28F5E34; Hm_lpvt_eae7ea7b5967c9be2ddb3158b3cbd890=1611572561'}
    data = {"ExternalProjectCode": appid}
    # data = json.dumps(data)   #  序列化成jsong
    r = requests.post(url=url, json=data, headers=headers)
    r.encoding = 'utf-8'
    # print(r.json())

    # print(r.json()['aaData'])
    # print("post执行状态码：%s" % r.json()['code'])
    # print("post执行结果：%s" % r.json()['msg'])
    # print("post本页数据总数：%s" % r.json()['data']['currentPageSize'])
    # print("页码：%s" % r.json()['data']['pageNum'])
    # print("每页大小：%s" % r.json()['data']['pageSize'])
    # print("总共%s页" % r.json()['data']['totalPage'])
    # print("项目总数总数：%s\n" % r.json()['data']['total'])
    data = r.json()['aaData'][0]
    # list1 = data['list']
    return data

def init_db():
    # 创建数据表
    sql = '''
        create table ls1
        (
        id integer primary key autoincrement,
        name text,
        appid text,
        no1 text,
        time text,
        is1 int 
        )
    '''

    conn = get_db_conn(db_file)  # 打开或创建数据库文件
    cur = conn.cursor()  # 创建游标
    cur.execute(sql)  # 执行sql语句
    conn.commit()  # 提交结果
    close_db_conn(cur,conn)

def up_data(dict, db_file1):
    sql = '''
    UPDATE ls1 SET no1 = ? WHERE appid = 33011220210125012001
    '''
    conn = get_db_conn(db_file1)
    cur = conn.cursor()  # 创建游标
    cur.executemany(sql, dict)  # 执行sql语句
    conn.commit()  # 提交结果
    close_db_conn(cur, conn)
    return cur.rowcount

def ask2(no1):
    url = 'http://jzgr.mohurd.gov.cn/zjhzs/Mgt/Project/DeleteProject'
    headers = {
        'Content-Type': 'application/json; charset=utf-8',
        'cookie': 'Hm_lvt_eae7ea7b5967c9be2ddb3158b3cbd890=1611560500; auth.jzgr.mohurd=E8F6B78924847D53F9ABC01AAD0CB10143A50C4AF325EE3ABD3B535C69906CE725015F7A01BCE509BD84CBCFE440D6F1AF48DA9EB7958DA457075582AE7640BFA5B7E706681B412BE55ED68D0F4693CC9C695AC44859BD5DBB453154A19F96DDAA54EF6A1BB0E72CA077125AD37816D051B3780CB533E94DD511377880B72719C6D7109D7D4CBCF25D35A3654DBC5EA26DEB82E369955A973CABACFA3B99B00E0A845ACDEC42CC122EFE1BC38918572A92ED0F11DC7BD0E1DCDDB83A8F6820E6CCA7033BB8D0A32AF48D513D2D07B3C26D39AAC4FB54BDEB626A5B6FA5225724B82CC3FD73C41F597E1E2611C6CF072761B2008402CE74976E81BF1755B285FC8F973D2E21D16519A61A39711F38C06E05AADD4BE54EFEFA2991ED1DB57CFFAD23002EFA4EC5E79A54BBBE26E00308830B1E4CFAF4719A70931A9F5B3F56DD3286E3791BA333160FB93DBCDEBF03824E4B4F2AFDD473F305E219339DE8B45B0C92500991706977F5F6308ED182919F9BB4C9CD3788EBEAFF305A5715D62FFDF791715396247F5ADDE1B8592459999C95A458F9D867053E4779B494A3677769CDFE35059B840C1B368CA918E0B1616B30E57977BC9B6C8A3D1BB2FF94899F3292F3838952E8BFE949777A0D7C961E826F74810C57DB77C0FE3493D332CA50B4B7E8B2B6CE51E665E222861682C61D09D0AAD7D7C8FC441C4B9485BE08FB18A542547FA771EB54D0A05C40DB0D685FFEE517106BD7C22CEE1A463184693D38DCE856E7EDF3D61DF2325A3FC85497C5; verifycode.jzgr.mohurd=22A0601DC39C1F8E301BAF995A9D0D3DF53E144E2C5C15B28F5E34; Hm_lpvt_eae7ea7b5967c9be2ddb3158b3cbd890=1611572561'}
    data = {"projectSysNo": no1,
            "resonTxt": "项目重复创建",
            "resonType": "1"}
    # data = json.dumps(data)   #  序列化成jsong
    r = requests.post(url=url, json=data, headers=headers)
    r.encoding = 'utf-8'
    print(r.json())

    # print(r.json()['aaData'])
    # print("post执行状态码：%s" % r.json()['code'])
    # print("post执行结果：%s" % r.json()['msg'])
    # print("post本页数据总数：%s" % r.json()['data']['currentPageSize'])
    # print("页码：%s" % r.json()['data']['pageNum'])
    # print("每页大小：%s" % r.json()['data']['pageSize'])
    # print("总共%s页" % r.json()['data']['totalPage'])
    # print("项目总数总数：%s\n" % r.json()['data']['total'])
    # data = r.json()['aaData'][0]
    # list1 = data['list']
    # return data


for i in range(len(list4)):
    appid1 = (list4[i])
    dict = askUrl(appid1)
    dict1 = (dict['SysNo'], dict['ExternalProjectCode'], dict['ProjectName'], appid1)
    no1 = dict['SysNo']
    print(dict1)
    ask2(no1)


    # print(type(dict1))
    # dict1 = [str(dict['SysNo']), appid1]
    # print(dict1)
    # up_data(dict1, db_file)

    # print(dict['SysNo'])

    # print(appid1)
    # select_score_all(appid1)
# init_db()
# data = askUrl()
# print(data)